---
title: "Lidar"
author: "B. Maranget"
date: "11/09/2024"
output: 
  html_document: 
    number_sections: yes
    toc: yes
editor_options: 
  chunk_output_type: console
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(cache = TRUE)
# Passer la valeur suivante à TRUE pour reproduire les extractions.
knitr::opts_chunk$set(eval = FALSE)
knitr::opts_chunk$set(warning = FALSE)
```


# Objet

explorer Lidar et R pour les arbres

https://r-lidar.github.io/lidRbook/io.html


On cherche d'abord la localisation x y précise des arbres

# Environnement


## Librairies


```{r , eval=TRUE}
library(sf)
library(lidR)
library(rgl)# pour visu 3d
library(mapsf)
library(leaflet)
library(mapview)
```



## Chemins

Les fichiers de téléchargement sont lourds, on les met dans data/gros
et on modifie le gitignore pour les exclure

Récupération des formes pour couper

```{r}
zone <- st_read("data/zone.gpkg")
mapview(zone)
zone <- st_transform(zone, 2154)
```

B
Les fichiers laz

```{r}
lasf <- dir("data/gros", "*.laz")
f <- lasf [1]
las <- readLAS(paste0("data/gros/",f), select = "xyz")
plot(las)
sel1 <- clip_roi(las, zone)
```




```{r}
plot(sel1)
plot(sel1, color = "Classification", bg = "white", axis = TRUE, legend = TRUE)
```



vue 2d

```{r}
library(ggplot2)

ggplot(payload(sel1), aes(X,Z, color = Z)) + 
  geom_point(size = 0.5) + 
  coord_equal() + 
  theme_minimal() +
  scale_color_gradientn(colours = height.colors(50))
```


Sans l'option, 1 G°, avec l'option, 400 M° voire 49,5 M°



traduction rapide du manuel lidR

https://r-lidar.github.io/lidRbook/io.html

donnée position x y z intensité rang angle d'incidence

laz format compressé de las

l'objet est constitué de l'en tête et du nuage de point




# rgl



# couper



# enregistrer

```{r}
writeLAS(sel1, "data/mare.las")
plot(sel1, bg="white")
open3d()# Open a new RGL device
bg3d(color = "white")
points3d(sel1)
```



# présenter


```{r}
las <- readLAS("data/mare.las")
plot (las)
las
las$Classification
plot(las, color = "Classification", bg = "white", axis = TRUE, legend = TRUE)
df <- payload(las)
df
```




